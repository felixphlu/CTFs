---
description: Wireshark, VirusTotal, Powershell, any.run, lolbas
---

# LetsDefend\_CTF\_IcedIDMalwareFamily

<figure><img src=".gitbook/assets/image (34).png" alt=""><figcaption></figcaption></figure>

This CTF starts by asking for the sha256 hash of the malspam attacmment. I will use VirusTotal to check the file hash.

<figure><img src=".gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

I could have also pulled the hashes by using “sha256sum”(Linux) or “Get-FileHash -Algorithm SHA256″(Windows) commands to get the SHA256 hash of the files. However, the malspam attachment would disappear after a few seconds as it is running a macro to self delete itself. For this reason, I used VirusTotal to check the SHA256 hash value.

The next question asks the following:

<figure><img src=".gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

For this question, I will use any.run and enter the SHA256 hash in the search.

I come out with a bunch of uploads&#x20;

<figure><img src=".gitbook/assets/image (8) (1).png" alt=""><figcaption></figcaption></figure>

I will select one and I get the following:

<figure><img src=".gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>

Now to answer the question, I will go to the child process of WINWORD.EXE which is explorer.exe and I can see the child process command line:

<figure><img src=".gitbook/assets/image (6) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (7) (1).png" alt=""><figcaption></figcaption></figure>

I could also use lolbas to check the files and when I download what malware can piggyback off the payload.

<figure><img src=".gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>

The next question asks for the SHA256 file hash of the HTML application. I will use VirusTotal for this

<figure><img src=".gitbook/assets/image (10) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (11) (1).png" alt=""><figcaption></figcaption></figure>

Next question:

<figure><img src=".gitbook/assets/image (12) (1).png" alt=""><figcaption></figcaption></figure>

I will use any.run for this again and check the DLL run method.

<figure><img src=".gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

I will copy the Command Line:

<figure><img src=".gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (16) (1).png" alt=""><figcaption></figcaption></figure>

The next question:

<figure><img src=".gitbook/assets/image (17) (1).png" alt=""><figcaption></figcaption></figure>

I will look at the image file dll installer on VirusTotal to get the SHA256 hash value:

<figure><img src=".gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (19) (1).png" alt=""><figcaption></figcaption></figure>

Next question:

<figure><img src=".gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>

I use any.run again to find any DNS requests and find:

<figure><img src=".gitbook/assets/image (21) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (22) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

For this next question, I will use Wireshark to find the URL for the DLL installer.

I can find it in WireShark by looking at packet #6 which is the HTTP GET request.

<figure><img src=".gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

It is lisstssed under the Hypertext Transfer Protocol under Request URI

<figure><img src=".gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

The next question is asking for the two IP addresses identified as C2 servers.

With Wireshark, I will analyze the pcap file and filter out for DNS.

<figure><img src=".gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

I can see that they tried to communicate with the C2 server several times and identified the following two IP addresses:

<figure><img src=".gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

For this next questiuon, I noticed from before a few domains in the DNS list:

<figure><img src=".gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

Again, I stay looking at the DNS protocol and see the two contacted by the installer DLL&#x20;

<figure><img src=".gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

The aws.amazon.com and supplemmentik.top are the two domains that were contacted by the installer DLL after it was executed.

<figure><img src=".gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

Next question is:

<figure><img src=".gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

For this next question, I will add columns for ports:

<figure><img src=".gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

Specifically, I will add the source port and destination port:

<figure><img src=".gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

I will look for the Destination Port 8080 in my filter:

<figure><img src=".gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

As highlighted, there are only two SYN requests, the destination ip address is 38.135.122.194 as listed:

<figure><img src=".gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure>

Next question:

<figure><img src=".gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure>

To answer this, I will check the scheduled task file:

<figure><img src=".gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

I can find it near the bottom of the text file:

<figure><img src=".gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (24).png" alt=""><figcaption></figcaption></figure>

The above question, it is listed in the name of the challenge.

I could also use OSINT like the question asked and I can find it looking at the collectionBoxConst.jpg

<figure><img src=".gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

The security vendors list it as Trojan IcedID family

<figure><img src=".gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

Next question asks:

<figure><img src=".gitbook/assets/image (27).png" alt=""><figcaption></figcaption></figure>

For this question, I do a google search and look for OSINT regarding this malware family.

<figure><img src=".gitbook/assets/image (28).png" alt=""><figcaption></figcaption></figure>

To see the APT group name, I hover the "actor(s)" list.

<figure><img src=".gitbook/assets/image (29).png" alt=""><figcaption></figcaption></figure>

The APT group that worked is TA551:

<figure><img src=".gitbook/assets/image (30).png" alt=""><figcaption></figcaption></figure>

The last question is asking what is the MITRE ATT\&CK code for the initial access in this campaign?

The initial access was through email as the first question asked for malspam attachment which means it was delivered by mail. So I find that the MITRE ATT\&CK code is:

<figure><img src=".gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (33).png" alt=""><figcaption></figcaption></figure>

<figure><img src=".gitbook/assets/image (35).png" alt=""><figcaption></figcaption></figure>
